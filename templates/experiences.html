
{% extends "base.html" %}

{% block title %}Graduate Experiences{% if company %} at {{ company }}{% endif %} – Gradvantage{% endblock %}

{% block content %}
<div class="container py-5">
  <!-- Header Section -->
  <div class="text-center mb-5">
    {% if company %}
      <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb justify-content-center">
          <li class="breadcrumb-item"><a href="/companies" class="text-decoration-none">Companies</a></li>
          <li class="breadcrumb-item active">{{ company }}</li>
        </ol>
      </nav>
      <h1 class="display-4 fw-bold mb-3">{{ company }} Stories</h1>
      <p class="fs-5 text-muted">Real graduate experiences shared by our community</p>
    {% else %}
      <h1 class="display-4 fw-bold mb-3">Graduate Stories</h1>
      <p class="fs-5 text-muted">Authentic experiences from graduates across Australia's top firms</p>
    {% endif %}
  </div>

  <!-- Search and Filter Section -->
  <div class="row mb-5">
    <div class="col-md-8 mx-auto">
      <div class="card shadow-sm border-0">
        <div class="card-body p-4">
          <div class="row g-3">
            <div class="col-md-8">
              <div class="position-relative">
                <i class="bi bi-search position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"></i>
                <input type="text" class="form-control ps-5" id="searchInput" placeholder="Search by company, role, university...">
              </div>
            </div>
            <div class="col-md-4">
              <select class="form-select" id="outcomeFilter">
                <option value="">All Stories</option>
                <option value="offer">Success Stories</option>
                <option value="interview">Interview Tips</option>
                <option value="application">Application Process</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Stories Grid -->
  {% if experiences %}
    <div class="row g-4" id="experiencesContainer">
      {% for exp in experiences %}
      <div class="col-lg-6 story-card" 
           data-company="{{ exp.get('company', exp.get('firm_name', '')) }}" 
           data-role="{{ exp.get('role', '') }}" 
           data-content="{{ exp.get('content', '') }}">
        
        <div class="card h-100 shadow-sm border-0 rounded-4 overflow-hidden story-card-modern">
          <!-- Story Header -->
          <div class="card-header bg-gradient text-white border-0 p-4">
            <div class="d-flex align-items-center justify-content-between">
              <div class="d-flex align-items-center">
                <div class="story-icon me-3">
                  <i class="bi bi-person-circle fs-4"></i>
                </div>
                <div>
                  <h5 class="mb-1 fw-bold">
                    {{ exp.get('role', 'Graduate Experience') }}
                  </h5>
                  <div class="d-flex align-items-center gap-2">
                    <span class="company-name fw-medium">
                      {{ exp.get('company', exp.get('firm_name', 'Law Firm')) }}
                    </span>
                    {% if exp.get('experience_type') %}
                      <span class="opacity-75">•</span>
                      <span class="opacity-75">{{ exp.experience_type }}</span>
                    {% endif %}
                  </div>
                </div>
              </div>
              
              <!-- Story Type Badge -->
              <div class="text-end">
                {% if exp.get('is_submission') %}
                  <span class="badge bg-success bg-opacity-75 text-white px-3 py-2">
                    <i class="bi bi-check-circle me-1"></i>Shared Story
                  </span>
                {% else %}
                  <span class="badge bg-primary bg-opacity-75 text-white px-3 py-2">
                    <i class="bi bi-chat-dots me-1"></i>Experience
                  </span>
                {% endif %}
              </div>
            </div>
          </div>

          <!-- Story Content -->
          <div class="card-body p-4">
            <!-- Main Content -->
            <div class="story-section mb-4">
              {% if exp.get('content') %}
                <div class="story-content">
                  <p class="mb-0 lh-base">{{ exp.content }}</p>
                </div>
              {% endif %}
              
              {% if exp.get('application_stages') %}
                <div class="story-subsection mt-3">
                  <div class="d-flex align-items-center gap-2 mb-2">
                    <div class="story-section-icon bg-info-subtle text-info">
                      <i class="bi bi-list-check"></i>
                    </div>
                    <span class="fw-medium text-dark">Application Process</span>
                  </div>
                  <p class="story-text ms-4 mb-0">{{ exp.application_stages }}</p>
                </div>
              {% endif %}
              
              {% if exp.get('interview_experience') %}
                <div class="story-subsection mt-3">
                  <div class="d-flex align-items-center gap-2 mb-2">
                    <div class="story-section-icon bg-warning-subtle text-warning">
                      <i class="bi bi-chat-dots"></i>
                    </div>
                    <span class="fw-medium text-dark">Interview Experience</span>
                  </div>
                  <div class="story-quote ms-4">
                    <p class="mb-0">"{{ exp.interview_experience }}"</p>
                  </div>
                </div>
              {% endif %}
              
              {% if exp.get('advice') %}
                <div class="story-subsection mt-3">
                  <div class="d-flex align-items-center gap-2 mb-2">
                    <div class="story-section-icon bg-success-subtle text-success">
                      <i class="bi bi-lightbulb"></i>
                    </div>
                    <span class="fw-medium text-dark">Advice</span>
                  </div>
                  <div class="story-quote ms-4">
                    <p class="mb-0">{{ exp.advice }}</p>
                  </div>
                </div>
              {% endif %}
            </div>

            <!-- Categories -->
            {% if exp.get('cat_labels') %}
            <div class="story-section mb-3">
              <div class="d-flex flex-wrap gap-1">
                {% for label in exp.cat_labels %}
                  <span class="badge bg-primary-subtle text-primary">{{ label }}</span>
                {% endfor %}
              </div>
            </div>
            {% endif %}

            <!-- Story Metadata -->
            <div class="story-section">
              <div class="row g-2 text-muted small">
                {% if exp.get('user_name') %}
                  <div class="col-sm-6">
                    <i class="bi bi-person me-1"></i>Shared by {{ exp.user_name }}
                  </div>
                {% endif %}
                {% if exp.get('quality_score') %}
                  <div class="col-sm-6">
                    <i class="bi bi-star me-1"></i>Quality: {{ "%.1f"|format(exp.quality_score) }}/10
                  </div>
                {% endif %}
                {% if exp.get('timestamp') %}
                  <div class="col-sm-6">
                    <i class="bi bi-clock me-1"></i>Recently shared
                  </div>
                {% endif %}
              </div>
            </div>
          </div>

          <!-- Story Footer -->
          <div class="story-footer">
            <div class="d-flex justify-content-between align-items-center">
              <div class="story-reactions d-flex gap-2">
                <button class="btn btn-sm btn-outline-primary">
                  <i class="bi bi-hand-thumbs-up me-1"></i>Helpful
                </button>
                <button class="btn btn-sm btn-outline-secondary">
                  <i class="bi bi-bookmark me-1"></i>Save
                </button>
              </div>
              <div class="text-muted small">
                <span class="badge bg-light text-dark">
                  {{ exp.get('theme', 'Graduate Story') }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Load More Button -->
    <div class="text-center mt-5">
      <button class="btn btn-outline-primary btn-lg px-4" id="loadMoreBtn">
        <i class="bi bi-arrow-down-circle me-2"></i>Load More Stories
      </button>
    </div>

  {% else %}
    <!-- Empty State -->
    <div class="empty-state text-center py-5">
      <div class="mb-4">
        <i class="bi bi-chat-square-text text-muted" style="font-size: 4rem;"></i>
      </div>
      <h4 class="fw-medium mb-3">No stories yet{% if company %} for {{ company }}{% endif %}</h4>
      <p class="text-muted mb-4">Be the first to share your graduate experience and help build our community!</p>
      <a href="/submit" class="btn btn-primary btn-lg px-4">
        <i class="bi bi-plus-circle me-2"></i>Share Your Story
      </a>
    </div>
  {% endif %}
</div>

<!-- JavaScript for Search and Filter -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    const outcomeFilter = document.getElementById('outcomeFilter');
    const storyCards = document.querySelectorAll('.story-card');
    const loadMoreBtn = document.getElementById('loadMoreBtn');
    
    let visibleCards = 6;
    
    function updateCardVisibility() {
        storyCards.forEach((card, index) => {
            if (index < visibleCards) {
                card.style.display = card.dataset.visible !== 'false' ? 'block' : 'none';
            } else {
                card.style.display = 'none';
            }
        });
        
        if (loadMoreBtn) {
            const visibleCount = Array.from(storyCards).filter(card => card.dataset.visible !== 'false').length;
            loadMoreBtn.style.display = visibleCards >= visibleCount ? 'none' : 'block';
        }
    }

    function filterStories() {
        const searchTerm = searchInput.value.toLowerCase();
        const selectedFilter = outcomeFilter.value.toLowerCase();

        storyCards.forEach(card => {
            const company = card.dataset.company.toLowerCase();
            const role = card.dataset.role.toLowerCase();
            const content = card.dataset.content.toLowerCase();

            const matchesSearch = !searchTerm || 
                                company.includes(searchTerm) || 
                                role.includes(searchTerm) || 
                                content.includes(searchTerm);
            
            const matchesFilter = !selectedFilter || content.includes(selectedFilter);

            if (matchesSearch && matchesFilter) {
                card.dataset.visible = 'true';
                card.classList.add('fade-in');
            } else {
                card.dataset.visible = 'false';
                card.classList.remove('fade-in');
            }
        });
        
        visibleCards = 6;
        updateCardVisibility();
    }

    if (searchInput) {
        searchInput.addEventListener('input', filterStories);
    }
    
    if (outcomeFilter) {
        outcomeFilter.addEventListener('change', filterStories);
    }
    
    if (loadMoreBtn) {
        loadMoreBtn.addEventListener('click', function() {
            visibleCards += 6;
            updateCardVisibility();
        });
    }
    
    updateCardVisibility();
});
</script>
{% endblock %}
