{% extends "base.html" %}

{% block title %}Share Your Story – Gradvantage{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <!-- Header Section -->
      <div class="text-center mb-5">
        <div class="mb-4">
          <div class="bg-primary-subtle text-primary rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
            <i class="bi bi-chat-heart fs-1"></i>
          </div>
        </div>
        <h1 class="display-5 fw-bold mb-3">Share Your Graduate Story</h1>
        <p class="fs-5 text-muted mb-4">
          Help fellow graduates by sharing your authentic experience. Your story could be the insight someone needs to land their dream role.
        </p>
        <div class="d-flex justify-content-center gap-4 text-muted small">
          <div><i class="bi bi-shield-check me-1"></i>Anonymous & Safe</div>
          <div><i class="bi bi-clock me-1"></i>Takes 3-5 minutes</div>
          <div><i class="bi bi-people me-1"></i>Helps thousands of students</div>
        </div>
      </div>

      <!-- Form Card -->
      <div class="card shadow-lg border-0 rounded-4">
        <div class="card-body p-5">
          <form method="POST" class="needs-validation" novalidate>
            <!-- Progress Indicator -->
            <div class="progress mb-5" style="height: 6px;">
              <div class="progress-bar bg-gradient" role="progressbar" style="width: 0%" id="formProgress"></div>
            </div>

            <!-- Basic Information Section -->
            <div class="form-section mb-5">
              <h4 class="fw-semibold mb-4 text-primary">
                <span class="step-number">1</span>
                Basic Information
              </h4>

              <div class="row g-4">
                <div class="col-md-6">
                  <label for="company" class="form-label fw-medium">Company *</label>
                  <input type="text" class="form-control form-control-lg" id="company" name="company" required placeholder="e.g., Allens, Clayton Utz">
                  <div class="invalid-feedback">Please enter the company name.</div>
                </div>

                <div class="col-md-6">
                  <label for="role" class="form-label fw-medium">Role/Program *</label>
                  <input type="text" class="form-control form-control-lg" id="role" name="role" required placeholder="e.g., Graduate Lawyer, Summer Clerk">
                  <div class="invalid-feedback">Please enter the role or program.</div>
                </div>

                <div class="col-md-6">
                  <label for="experience_type" class="form-label fw-medium">Experience Type *</label>
                  <select class="form-select form-select-lg" id="experience_type" name="experience_type" required>
                    <option value="">Select experience type</option>
                    <option value="Application">Application Process</option>
                    <option value="Interview">Interview Experience</option>
                    <option value="Assessment">Assessment Centre</option>
                    <option value="Internship">Internship/Clerkship</option>
                    <option value="Graduate Program">Graduate Program</option>
                    <option value="General">General Experience</option>
                  </select>
                  <div class="invalid-feedback">Please select an experience type.</div>
                </div>

                <div class="col-md-6">
                  <label for="theme" class="form-label fw-medium">Main Theme *</label>
                  <select class="form-select form-select-lg" id="theme" name="theme" required>
                    <option value="">Select main theme</option>
                    <option value="Programs">Programs</option>
                    <option value="Applications">Applications</option>
                    <option value="Interviews">Interviews</option>
                    <option value="Salaries">Salaries</option>
                    <option value="Start Dates">Start Dates</option>
                    <option value="Offers & Rejections">Offers & Rejections</option>
                    <option value="Firm Culture">Firm Culture</option>
                    <option value="Practice Areas">Practice Areas</option>
                    <option value="Locations">Locations</option>
                    <option value="Other">Other</option>
                  </select>
                  <div class="invalid-feedback">Please select a theme.</div>
                </div>
              </div>
            </div>

            <!-- Experience Details Section -->
            <div class="form-section mb-5">
              <h4 class="fw-semibold mb-4 text-primary">
                <span class="step-number">2</span>
                Share Your Experience
              </h4>

              <!-- Dynamic Fields Container -->
            <div id="dynamicFields">
              <!-- Application Process Field -->
              <div class="mb-4" id="field-application-stages" style="display: none;">
                <label for="application_stages" class="form-label fw-medium">Application Process</label>
                <textarea class="form-control" id="application_stages" name="application_stages" rows="4" 
                         placeholder="Describe the application stages, timeline, requirements, etc."></textarea>
                <div class="form-text">Share details about the application process, deadlines, required documents, etc.</div>
              </div>

              <!-- Interview Experience Field -->
              <div class="mb-4" id="field-interview-experience" style="display: none;">
                <label for="interview_experience" class="form-label fw-medium">Interview Experience</label>
                <textarea class="form-control" id="interview_experience" name="interview_experience" rows="4" 
                         placeholder="Describe your interview experience, questions asked, format, etc."></textarea>
                <div class="form-text">Include interview format, types of questions, duration, and your overall experience.</div>
              </div>

              <!-- Assessment Centre Field -->
              <div class="mb-4" id="field-assessment-centre" style="display: none;">
                <label for="assessment_centre" class="form-label fw-medium">Assessment Centre Experience</label>
                <textarea class="form-control" id="assessment_centre" name="assessment_centre" rows="4" 
                         placeholder="Describe the assessment centre activities, group exercises, presentations, etc."></textarea>
                <div class="form-text">Share details about group exercises, case studies, presentations, and other assessment activities.</div>
              </div>

              <!-- Program Structure Field -->
              <div class="mb-4" id="field-program-structure" style="display: none;">
                <label for="program_structure" class="form-label fw-medium">Program Structure & Experience</label>
                <textarea class="form-control" id="program_structure" name="program_structure" rows="4" 
                         placeholder="Describe the program structure, rotations, training, mentorship, etc."></textarea>
                <div class="form-text">Share details about rotation structure, training programs, mentorship, and learning opportunities.</div>
              </div>

              <!-- Salary & Benefits Field -->
              <div class="mb-4" id="field-salary-benefits" style="display: none;">
                <label for="salary_benefits" class="form-label fw-medium">Salary & Benefits Information</label>
                <textarea class="form-control" id="salary_benefits" name="salary_benefits" rows="4" 
                         placeholder="Share details about compensation, benefits, bonuses, etc."></textarea>
                <div class="form-text">Include base salary, superannuation, bonuses, allowances, and any other benefits or perks.</div>
              </div>

              <!-- Culture & Environment Field -->
              <div class="mb-4" id="field-culture-environment" style="display: none;">
                <label for="culture_environment" class="form-label fw-medium">Firm Culture & Environment</label>
                <textarea class="form-control" id="culture_environment" name="culture_environment" rows="4" 
                         placeholder="Describe the workplace culture, team dynamics, work environment, etc."></textarea>
                <div class="form-text">Share your experience with firm culture, team relationships, management style, and workplace atmosphere.</div>
              </div>

              <!-- Work Hours & Workload Field -->
              <div class="mb-4" id="field-hours-workload" style="display: none;">
                <label for="hours_workload" class="form-label fw-medium">Hours & Workload Experience</label>
                <textarea class="form-control" id="hours_workload" name="hours_workload" rows="4" 
                         placeholder="Describe typical hours, workload expectations, work-life balance, etc."></textarea>
                <div class="form-text">Share details about daily/weekly hours, busy periods, overtime expectations, and work-life balance.</div>
              </div>

              <!-- Practice Areas Field -->
              <div class="mb-4" id="field-practice-areas" style="display: none;">
                <label for="practice_areas" class="form-label fw-medium">Practice Areas & Work Type</label>
                <textarea class="form-control" id="practice_areas" name="practice_areas" rows="4" 
                         placeholder="Describe the practice areas you worked in and types of work you did."></textarea>
                <div class="form-text">Share details about the practice areas, types of matters, client work, and learning opportunities.</div>
              </div>

              <!-- General Experience Field -->
              <div class="mb-4" id="field-general-experience" style="display: none;">
                <label for="general_experience" class="form-label fw-medium">Your Experience</label>
                <textarea class="form-control" id="general_experience" name="general_experience" rows="4" 
                         placeholder="Share your overall experience and any important details."></textarea>
                <div class="form-text">Describe your experience in detail, including key highlights and important information.</div>
              </div>
            </div>

            <!-- Always Visible Section -->
            <div class="form-section mb-5">
              <h4 class="fw-semibold mb-4 text-success">
                <span class="step-number">3</span>
                Share Your Tips & Advice
              </h4>

              <!-- Pro Tip Field (always available) -->
              <div class="mb-4" id="field-pro-tip">
                <label for="pro_tip" class="form-label fw-medium">Pro Tip <span class="text-primary">✨</span></label>
                <input type="text" class="form-control form-control-lg" id="pro_tip" name="pro_tip" 
                       placeholder="Share one key tip that would help future applicants" maxlength="200">
                <div class="form-text">A concise, actionable tip that could make a real difference (max 200 characters).</div>
              </div>

              <!-- Advice & Tips Field (always available) -->
              <div class="mb-4" id="field-advice">
                <label for="advice" class="form-label fw-medium">Detailed Advice & Tips</label>
                <textarea class="form-control" id="advice" name="advice" rows="4" 
                         placeholder="What detailed advice would you give to future applicants?"></textarea>
                <div class="form-text">Share your detailed learnings and tips for future candidates.</div>
              </div>
            </div>
            </div>

            <!-- Submission Section -->
            <div class="form-section">
              <div class="bg-light rounded-3 p-4 mb-4">
                <div class="d-flex align-items-start">
                  <i class="bi bi-info-circle-fill text-primary me-3 mt-1"></i>
                  <div>
                    <h6 class="fw-semibold mb-2">Privacy & Guidelines</h6>
                    <ul class="small text-muted mb-0 ps-3">
                      <li>All submissions are anonymous and secure</li>
                      <li>Don't include personal details (names, emails, phone numbers)</li>
                      <li>Be honest and constructive in your feedback</li>
                      <li>Your story helps build a supportive graduate community</li>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                <button type="submit" class="btn btn-primary btn-lg px-5 py-3">
                  <i class="bi bi-send me-2"></i>Share My Story
                </button>
                <a href="/" class="btn btn-outline-secondary btn-lg px-4 py-3">Cancel</a>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Success Stories Preview -->
      <div class="mt-5 text-center">
        <p class="text-muted mb-3">Join thousands of graduates who have shared their stories</p>
        <div class="d-flex justify-content-center gap-4 flex-wrap">
          <div class="badge bg-success-subtle text-success px-3 py-2">
            <i class="bi bi-check-circle me-1"></i>2,000+ Stories Shared
          </div>
          <div class="badge bg-info-subtle text-info px-3 py-2">
            <i class="bi bi-building me-1"></i>150+ Companies
          </div>
          <div class="badge bg-warning-subtle text-warning px-3 py-2">
            <i class="bi bi-mortarboard me-1"></i>50+ Universities
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.step-number {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  background: var(--bs-primary);
  color: white;
  border-radius: 50%;
  font-size: 0.9rem;
  font-weight: 600;
  margin-right: 0.75rem;
}

.form-section {
  opacity: 0;
  animation: fadeInUp 0.6s ease forwards;
}

.form-section:nth-child(1) { animation-delay: 0.1s; }
.form-section:nth-child(2) { animation-delay: 0.2s; }
.form-section:nth-child(3) { animation-delay: 0.3s; }

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.form-control:focus, .form-select:focus {
  border-color: var(--bs-primary);
  box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.15);
}

.card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.btn {
  transition: all 0.2s ease;
}

.btn:hover {
  transform: translateY(-1px);
}

#dynamicFields .mb-4 {
  transition: all 0.3s ease;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.querySelector('form');
  const themeSelect = document.getElementById('theme');
  const experienceTypeSelect = document.getElementById('experience_type');
  const progressBar = document.getElementById('formProgress');
  const allFields = form.querySelectorAll('input[required], select[required], textarea');

  // Dynamic field visibility based on experience type and theme
  function updateFields() {
    const selectedTheme = themeSelect.value;
    const selectedExperienceType = experienceTypeSelect.value;
    const dynamicFields = document.getElementById('dynamicFields');
    const allDynamicFields = dynamicFields.querySelectorAll('[id^="field-"]');

    // Hide all dynamic fields first
    allDynamicFields.forEach(field => {
      field.style.display = 'none';
    });

    // Define field mappings based on experience type and theme
    const fieldMappings = {
      'Application': {
        'Applications': ['field-application-stages', 'field-advice'],
        'Interviews': ['field-interview-experience', 'field-advice'],
        'Assessment': ['field-assessment-centre', 'field-advice'],
        'Graduate Program': ['field-program-structure', 'field-advice'],
        'Internship': ['field-program-structure', 'field-advice'],
        'Salaries': ['field-salary-benefits', 'field-advice'],
        'Firm Culture': ['field-culture-environment', 'field-advice'],
        'Practice Areas': ['field-practice-areas', 'field-advice'],
        'Locations': ['field-general-experience', 'field-advice'], // General for locations
        'Other': ['field-general-experience', 'field-advice']
      },
      'Interview': {
        'Interviews': ['field-interview-experience', 'field-advice'],
        'Applications': ['field-application-stages', 'field-advice'], // Relevant for some interview processes
        'Assessment': ['field-assessment-centre', 'field-advice'],
        'Salaries': ['field-salary-benefits', 'field-advice'],
        'Firm Culture': ['field-culture-environment', 'field-advice'],
        'Practice Areas': ['field-practice-areas', 'field-advice'],
        'Other': ['field-general-experience', 'field-advice']
      },
      'Assessment': {
        'Assessment': ['field-assessment-centre', 'field-advice'],
        'Interviews': ['field-interview-experience', 'field-advice'],
        'Applications': ['field-application-stages', 'field-advice'],
        'Firm Culture': ['field-culture-environment', 'field-advice'],
        'Other': ['field-general-experience', 'field-advice']
      },
      'Internship': {
        'Graduate Program': ['field-program-structure', 'field-advice'],
        'Internship': ['field-program-structure', 'field-advice'], // Redundant but for clarity
        'Interviews': ['field-interview-experience', 'field-advice'],
        'Salaries': ['field-salary-benefits', 'field-advice'],
        'Firm Culture': ['field-culture-environment', 'field-advice'],
        'Practice Areas': ['field-practice-areas', 'field-advice'],
        'Other': ['field-general-experience', 'field-advice']
      },
      'Graduate Program': {
        'Graduate Program': ['field-program-structure', 'field-advice'],
        'Interviews': ['field-interview-experience', 'field-advice'],
        'Applications': ['field-application-stages', 'field-advice'],
        'Salaries': ['field-salary-benefits', 'field-advice'],
        'Firm Culture': ['field-culture-environment', 'field-advice'],
        'Practice Areas': ['field-practice-areas', 'field-advice'],
        'Other': ['field-general-experience', 'field-advice']
      },
      'General': {
        'Other': ['field-general-experience', 'field-advice'],
        'Firm Culture': ['field-culture-environment', 'field-advice'],
        'Salaries': ['field-salary-benefits', 'field-advice'],
        'Locations': ['field-general-experience', 'field-advice']
      }
    };

    const relevantFields = fieldMappings[selectedExperienceType]?.[selectedTheme] || fieldMappings[selectedExperienceType]?.['Other'] || ['field-advice'];

    relevantFields.forEach(fieldId => {
      const fieldElement = document.getElementById(fieldId);
      if (fieldElement) {
        fieldElement.style.display = 'block';
      }
    });

    // Ensure 'Advice & Tips' is always shown if not explicitly hidden by a theme
    if (!relevantFields.includes('field-advice')) {
      const adviceField = document.getElementById('field-advice');
      if (adviceField) {
        adviceField.style.display = 'block';
      }
    }
  }

  // Helper function to update field content (labels, placeholders, help text)
  function updateFieldContent(fieldId, labelText, placeholderText, helpText) {
    const fieldContainer = document.getElementById(fieldId);
    if (!fieldContainer) return;

    const label = fieldContainer.querySelector('label');
    const textarea = fieldContainer.querySelector('textarea');
    const helpDiv = fieldContainer.querySelector('.form-text');

    if (label) label.textContent = labelText;
    if (textarea) textarea.placeholder = placeholderText;
    if (helpDiv) helpDiv.textContent = helpText;
  }

  // Update progress bar
  function updateProgress() {
    // Only count required fields for progress
    const requiredFields = Array.from(allFields).filter(field => field.hasAttribute('required'));
    const filledRequiredFields = requiredFields.filter(field => {
      if (field.type === 'text' || field.tagName === 'TEXTAREA') {
        return field.value.trim().length > 0;
      }
      return field.value !== '';
    });

    const progress = requiredFields.length > 0 ? (filledRequiredFields.length / requiredFields.length) * 100 : 0;
    progressBar.style.width = progress + '%';

    if (progress > 75) {
      progressBar.classList.remove('bg-gradient');
      progressBar.classList.add('bg-success');
    } else if (progress > 50) {
      progressBar.classList.remove('bg-success');
      progressBar.classList.add('bg-gradient');
    } else {
      progressBar.classList.remove('bg-success');
      progressBar.classList.add('bg-gradient');
    }
  }

  // Form validation
  function validateForm() {
    form.classList.add('was-validated');
    return form.checkValidity();
  }

  // Event listeners
  themeSelect.addEventListener('change', updateFields);
  experienceTypeSelect.addEventListener('change', updateFields);

  allFields.forEach(field => {
    field.addEventListener('input', updateProgress);
    field.addEventListener('change', updateProgress);
  });

  form.addEventListener('submit', function(e) {
    e.preventDefault();

    if (validateForm()) {
      // Add loading state
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Sharing Your Story...';
      submitBtn.disabled = true;

      // Submit form after short delay for UX
      setTimeout(() => {
        form.submit();
      }, 1000);
    }
  });

  // Initialize
  updateFields();
  updateProgress();
});
</script>
{% endblock %}