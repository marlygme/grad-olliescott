
{% extends "base.html" %}

{% block title %}Share Your Story â€“ Gradvantage{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <!-- Header Section -->
      <div class="text-center mb-5">
        <div class="mb-4">
          <div class="bg-primary-subtle text-primary rounded-circle d-inline-flex align-items-center justify-content-center" style="width: 80px; height: 80px;">
            <i class="bi bi-chat-heart fs-1"></i>
          </div>
        </div>
        <h1 class="display-5 fw-bold mb-3">Share Your Graduate Story</h1>
        <p class="fs-5 text-muted mb-4">
          Help fellow graduates by sharing your authentic experience. Your story could be the insight someone needs to land their dream role.
        </p>
        <div class="d-flex justify-content-center gap-4 text-muted small">
          <div><i class="bi bi-shield-check me-1"></i>Anonymous & Safe</div>
          <div><i class="bi bi-clock me-1"></i>Takes 3-5 minutes</div>
          <div><i class="bi bi-people me-1"></i>Helps thousands of students</div>
        </div>
      </div>

      <!-- Form Card -->
      <div class="card shadow-lg border-0 rounded-4">
        <div class="card-body p-5">
          <form method="POST" class="needs-validation" novalidate>
            <!-- Progress Indicator -->
            <div class="progress mb-5" style="height: 6px;">
              <div class="progress-bar bg-gradient" role="progressbar" style="width: 0%" id="formProgress"></div>
            </div>

            <!-- Basic Information Section -->
            <div class="form-section mb-5">
              <h4 class="fw-semibold mb-4 text-primary">
                <span class="step-number">1</span>
                Basic Information
              </h4>
              
              <div class="row g-4">
                <div class="col-md-6">
                  <label for="company" class="form-label fw-medium">Company *</label>
                  <input type="text" class="form-control form-control-lg" id="company" name="company" required placeholder="e.g., Allens, Clayton Utz">
                  <div class="invalid-feedback">Please enter the company name.</div>
                </div>
                
                <div class="col-md-6">
                  <label for="role" class="form-label fw-medium">Role/Program *</label>
                  <input type="text" class="form-control form-control-lg" id="role" name="role" required placeholder="e.g., Graduate Lawyer, Summer Clerk">
                  <div class="invalid-feedback">Please enter the role or program.</div>
                </div>

                <div class="col-md-6">
                  <label for="experience_type" class="form-label fw-medium">Experience Type *</label>
                  <select class="form-select form-select-lg" id="experience_type" name="experience_type" required>
                    <option value="">Select experience type</option>
                    <option value="Application">Application Process</option>
                    <option value="Interview">Interview Experience</option>
                    <option value="Assessment">Assessment Centre</option>
                    <option value="Internship">Internship/Clerkship</option>
                    <option value="Graduate Program">Graduate Program</option>
                    <option value="General">General Experience</option>
                  </select>
                  <div class="invalid-feedback">Please select an experience type.</div>
                </div>

                <div class="col-md-6">
                  <label for="theme" class="form-label fw-medium">Main Theme *</label>
                  <select class="form-select form-select-lg" id="theme" name="theme" required>
                    <option value="">Select main theme</option>
                    <option value="Programs">Programs</option>
                    <option value="Applications">Applications</option>
                    <option value="Interviews">Interviews</option>
                    <option value="Salaries">Salaries</option>
                    <option value="Start Dates">Start Dates</option>
                    <option value="Offers & Rejections">Offers & Rejections</option>
                    <option value="Firm Culture">Firm Culture</option>
                    <option value="Practice Areas">Practice Areas</option>
                    <option value="Locations">Locations</option>
                    <option value="Other">Other</option>
                  </select>
                  <div class="invalid-feedback">Please select a theme.</div>
                </div>
              </div>
            </div>

            <!-- Experience Details Section -->
            <div class="form-section mb-5">
              <h4 class="fw-semibold mb-4 text-primary">
                <span class="step-number">2</span>
                Share Your Experience
              </h4>

              <!-- Dynamic Fields Container -->
              <div id="dynamicFields">
                <!-- Default fields that will be shown/hidden based on theme selection -->
                <div class="mb-4" id="field-application-stages">
                  <label for="application_stages" class="form-label fw-medium">Application Process (Optional)</label>
                  <textarea class="form-control" id="application_stages" name="application_stages" rows="4" 
                           placeholder="Describe the application stages, timeline, requirements, etc. (optional)"></textarea>
                  <div class="form-text">Share details about the application process, deadlines, required documents, etc. This field is optional.</div>
                </div>

                <div class="mb-4" id="field-interview-experience">
                  <label for="interview_experience" class="form-label fw-medium">Interview Experience</label>
                  <textarea class="form-control" id="interview_experience" name="interview_experience" rows="4" 
                           placeholder="Describe your interview experience, questions asked, format, etc."></textarea>
                  <div class="form-text">Include interview format, types of questions, duration, and your overall experience.</div>
                </div>

                <div class="mb-4" id="field-advice">
                  <label for="advice" class="form-label fw-medium">Advice & Tips</label>
                  <textarea class="form-control" id="advice" name="advice" rows="4" 
                           placeholder="What advice would you give to future applicants?"></textarea>
                  <div class="form-text">Share your key learnings and tips for future candidates.</div>
                </div>
              </div>
            </div>

            <!-- Submission Section -->
            <div class="form-section">
              <div class="bg-light rounded-3 p-4 mb-4">
                <div class="d-flex align-items-start">
                  <i class="bi bi-info-circle-fill text-primary me-3 mt-1"></i>
                  <div>
                    <h6 class="fw-semibold mb-2">Privacy & Guidelines</h6>
                    <ul class="small text-muted mb-0 ps-3">
                      <li>All submissions are anonymous and secure</li>
                      <li>Don't include personal details (names, emails, phone numbers)</li>
                      <li>Be honest and constructive in your feedback</li>
                      <li>Your story helps build a supportive graduate community</li>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                <button type="submit" class="btn btn-primary btn-lg px-5 py-3">
                  <i class="bi bi-send me-2"></i>Share My Story
                </button>
                <a href="/" class="btn btn-outline-secondary btn-lg px-4 py-3">Cancel</a>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Success Stories Preview -->
      <div class="mt-5 text-center">
        <p class="text-muted mb-3">Join thousands of graduates who have shared their stories</p>
        <div class="d-flex justify-content-center gap-4 flex-wrap">
          <div class="badge bg-success-subtle text-success px-3 py-2">
            <i class="bi bi-check-circle me-1"></i>2,000+ Stories Shared
          </div>
          <div class="badge bg-info-subtle text-info px-3 py-2">
            <i class="bi bi-building me-1"></i>150+ Companies
          </div>
          <div class="badge bg-warning-subtle text-warning px-3 py-2">
            <i class="bi bi-mortarboard me-1"></i>50+ Universities
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.step-number {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  background: var(--bs-primary);
  color: white;
  border-radius: 50%;
  font-size: 0.9rem;
  font-weight: 600;
  margin-right: 0.75rem;
}

.form-section {
  opacity: 0;
  animation: fadeInUp 0.6s ease forwards;
}

.form-section:nth-child(1) { animation-delay: 0.1s; }
.form-section:nth-child(2) { animation-delay: 0.2s; }
.form-section:nth-child(3) { animation-delay: 0.3s; }

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.form-control:focus, .form-select:focus {
  border-color: var(--bs-primary);
  box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.15);
}

.card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.btn {
  transition: all 0.2s ease;
}

.btn:hover {
  transform: translateY(-1px);
}

#dynamicFields .mb-4 {
  transition: all 0.3s ease;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.querySelector('form');
  const themeSelect = document.getElementById('theme');
  const progressBar = document.getElementById('formProgress');
  const allFields = form.querySelectorAll('input[required], select[required], textarea');
  
  // Dynamic field visibility based on theme
  function updateFields() {
    const selectedTheme = themeSelect.value;
    const dynamicFields = document.getElementById('dynamicFields');
    const allDynamicFields = dynamicFields.querySelectorAll('[id^="field-"]');
    
    // Hide all dynamic fields first
    allDynamicFields.forEach(field => {
      field.style.display = 'none';
    });
    
    // Update field content and visibility based on theme
    switch(selectedTheme) {
      case 'application_timeline':
      case 'selection_process':
      case 'eligibility_requirements':
        updateFieldContent('application_stages', 'Application Process (Optional)', 'Describe the application stages, timeline, requirements, deadlines, etc.', 'Share details about application deadlines, required documents, selection criteria, and the overall process timeline.');
        updateFieldContent('advice', 'Application Advice', 'What advice would you give to future applicants about the application process?', 'Share your key learnings about applying, tips for success, and what you wish you knew earlier.');
        document.getElementById('field-application-stages').style.display = 'block';
        document.getElementById('field-advice').style.display = 'block';
        break;
        
      case 'interview_tips':
        updateFieldContent('interview-experience', 'Interview Experience', 'Describe your interview experience, questions asked, format, duration, etc.', 'Include interview format, types of questions, duration, panel composition, and your overall experience.');
        updateFieldContent('advice', 'Interview Tips & Advice', 'What interview tips would you share with future candidates?', 'Share specific advice about preparation, common questions, what impressed the interviewers, and lessons learned.');
        document.getElementById('field-interview-experience').style.display = 'block';
        document.getElementById('field-advice').style.display = 'block';
        break;
        
      case 'pay_benefits':
        updateFieldContent('advice', 'Salary & Benefits Information', 'Share details about compensation, benefits, bonuses, and financial aspects.', 'Include base salary, superannuation, bonuses, allowances, and any other benefits or perks offered.');
        document.getElementById('field-advice').style.display = 'block';
        break;
        
      case 'hours_workload':
        updateFieldContent('advice', 'Hours & Workload Experience', 'Describe the typical hours, workload expectations, and work-life balance.', 'Share details about daily/weekly hours, busy periods, overtime expectations, flexibility, and how the workload impacted your experience.');
        document.getElementById('field-advice').style.display = 'block';
        break;
        
      case 'program_structure':
      case 'training_support':
        updateFieldContent('application_stages', 'Program Structure (Optional)', 'Describe the program structure, rotations, training, and learning opportunities.', 'Share details about rotation structure, training programs, mentorship, learning opportunities, and program organization.');
        updateFieldContent('advice', 'Program Insights & Advice', 'What would you tell someone considering this program?', 'Share your experience with the program structure, what you learned, and advice for making the most of the opportunity.');
        document.getElementById('field-application-stages').style.display = 'block';
        document.getElementById('field-advice').style.display = 'block';
        break;
        
      case 'secondments_mobility':
        updateFieldContent('advice', 'Secondments & Mobility Experience', 'Share your experience with secondments, interstate opportunities, or mobility within the firm.', 'Include details about secondment opportunities, interstate transfers, international options, and how these impacted your career development.');
        document.getElementById('field-advice').style.display = 'block';
        break;
        
      case 'culture_environment':
        updateFieldContent('advice', 'Culture & Environment Insights', 'Describe the workplace culture, team dynamics, and overall environment.', 'Share your experience with the firm culture, team relationships, management style, diversity, social activities, and workplace atmosphere.');
        document.getElementById('field-advice').style.display = 'block';
        break;
        
      default:
        // Show all fields for other themes
        allDynamicFields.forEach(field => {
          field.style.display = 'block';
        });
    }
  }
  
  // Helper function to update field content
  function updateFieldContent(fieldId, labelText, placeholderText, helpText) {
    const field = document.getElementById(fieldId);
    const fieldContainer = field ? field.closest('.mb-4') : null;
    
    if (fieldContainer) {
      const label = fieldContainer.querySelector('label');
      const textarea = fieldContainer.querySelector('textarea');
      const helpDiv = fieldContainer.querySelector('.form-text');
      
      if (label) label.textContent = labelText;
      if (textarea) textarea.placeholder = placeholderText;
      if (helpDiv) helpDiv.textContent = helpText;
    }
  }
  
  // Update progress bar
  function updateProgress() {
    // Only count required fields for progress
    const requiredFields = Array.from(allFields).filter(field => field.hasAttribute('required'));
    const filledRequiredFields = requiredFields.filter(field => {
      if (field.type === 'text' || field.tagName === 'TEXTAREA') {
        return field.value.trim().length > 0;
      }
      return field.value !== '';
    });
    
    const progress = requiredFields.length > 0 ? (filledRequiredFields.length / requiredFields.length) * 100 : 0;
    progressBar.style.width = progress + '%';
    
    if (progress > 75) {
      progressBar.classList.remove('bg-gradient');
      progressBar.classList.add('bg-success');
    } else if (progress > 50) {
      progressBar.classList.remove('bg-success');
      progressBar.classList.add('bg-gradient');
    }
  }
  
  // Form validation
  function validateForm() {
    form.classList.add('was-validated');
    return form.checkValidity();
  }
  
  // Event listeners
  themeSelect.addEventListener('change', updateFields);
  
  allFields.forEach(field => {
    field.addEventListener('input', updateProgress);
    field.addEventListener('change', updateProgress);
  });
  
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    if (validateForm()) {
      // Add loading state
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Sharing Your Story...';
      submitBtn.disabled = true;
      
      // Submit form after short delay for UX
      setTimeout(() => {
        form.submit();
      }, 1000);
    }
  });
  
  // Initialize
  updateFields();
  updateProgress();
});
</script>
{% endblock %}
